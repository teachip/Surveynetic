@page "/login"

@using Surveynetic.Client.Core.Interfaces.Services
@using Surveynetic.Shared.DTO.Account

@inject IUserService UserService

<h1>Login</h1>

<EditForm Model="Dto" OnValidSubmit="OnValidAsync" style="max-width:500px">
    <FluentValidationValidator />
    <p class="mb-2">
        <label>E-mail</label>
        <InputText class="form-control" @bind-Value="@Dto.Email" />
        <ValidationMessage For="@(() => Dto.Email)" />
    </p>
    <p class="mb-2">
        <label>Password</label>
        <InputText class="form-control" type="password" @bind-Value="@Dto.Password" />
        <ValidationMessage For="@(() => Dto.Password)" />
    </p>
    @if (isSending)
    {
        <button class="btn btn-primary float-right search disabled" disabled>
            <span class='fa-left fas fa-sync-alt spinning'></span> Signing In...
        </button>
    }
    else
    {
        <button class="btn btn-primary btn-outline-primary float-right search" type="submit"> Sign In</button>
    }
</EditForm>

@code {
    private readonly LoginDto Dto = new();

    private bool isSending;

    private async Task OnValidAsync()
    {
        isSending = true;
        await UserService.LoginAsync(Dto);
        isSending = false;
    }
}
